{{ 'custom-header.css' | asset_url | stylesheet_tag }}

<style>
  #sticky-header-{{ section.id }}{ position:fixed; top:0; left:0; right:0; z-index:1000; width:100%; }
  /* Mobile CTA sichtbar unter 990px, am Desktop ausgeblendet */
  @media (min-width: 991px){ .custom-header__cta-mobile{ display:none !important; } }
  @media (max-width: 990px){ .custom-header__cta-mobile{ display:flex; } }
</style>

<style>
  .custom-header-section-{{ section.id }}{
    --header-bg-color: {{ section.settings.background_color }};
    --padding-vertical: {{ section.settings.padding_vertical }}px;
    --padding-horizontal: {{ section.settings.padding_horizontal }}px;

    --logo-height: {{ section.settings.logo_height | default: 40 }}px;
    --header-min-height: calc(var(--logo-height) + (var(--padding-vertical) * 2));
    --brand-gap: 16px;

    /* NEU: CSS-Variablen für die Positionierung */
    --logo-offset-x: {{ section.settings.logo_offset_x }}px;
    --logo-offset-y: {{ section.settings.logo_offset_y }}px;
    --menu-offset-x: {{ section.settings.menu_offset_x }}px;
    --menu-offset-y: {{ section.settings.menu_offset_y }}px;

    /* Navigation Typo */
    --nav-font-family: {{ section.settings.nav_font.family }}, {{ section.settings.nav_font.fallback_families }};
    --nav-font-style: {{ section.settings.nav_font.style }};
    --nav-font-weight: {% if section.settings.nav_font_bold %}bold{% else %}{{ section.settings.nav_font.weight }}{% endif %};
    --nav-text-color: {{ section.settings.nav_text_color }};
    --nav-hover-color: {{ section.settings.nav_hover_color }};
    --nav-font-size: {{ section.settings.nav_font_size }}px;

    --btn-text-color: {{ section.settings.button_text_color }};
    --btn-bg-color: {{ section.settings.button_bg_color }};
    --btn-hover-text-color: {{ section.settings.button_hover_text_color }};
    --btn-hover-bg-color: {{ section.settings.button_hover_bg_color }};

    /* Back/Label Typo */
    --back-font-family: {{ section.settings.back_font.family }}, {{ section.settings.back_font.fallback_families }};
    --back-font-style: {{ section.settings.back_font.style }};
    --back-font-weight: {% if section.settings.back_font_bold %}bold{% else %}{{ section.settings.back_font.weight }}{% endif %};
    --back-text-color: {{ section.settings.back_text_color }};
    --back-hover-color: {{ section.settings.back_hover_color }};
    --back-font-size: {{ section.settings.back_font_size }}px;
  }
</style>

<header id="sticky-header-{{ section.id }}" class="custom-header-section custom-header-section-{{ section.id }}">
  <div class="custom-header__container">

    <div class="custom-header__brand">
      <a href="{{ shop.url }}" class="custom-header__logo">
        {% if section.settings.logo %}
          {% liquid
            assign h = section.settings.logo_height | default: 40
            assign w = h | times: section.settings.logo.aspect_ratio | round
          %}
          <img src="{{ section.settings.logo | image_url: width: w }}"
               alt="{{ section.settings.logo.alt | default: shop.name }}"
               class="custom-header__logo-img"
               height="{{ h }}" width="{{ w }}">
        {% else %}
          <span class="custom-header__logo-text"
                style="color: {{ section.settings.logo_color }}; font-size: {{ section.settings.logo_font_size }}px;">
            {{ section.settings.logo_text | default: shop.name }}
          </span>
        {% endif %}
      </a>

      {% if section.settings.show_back_button %}
        {% if section.settings.back_link != blank or section.settings.back_label != blank %}
          <a href="{{ section.settings.back_link | default: shop.url }}"
             class="custom-header__back"
             aria-label="{{ section.settings.back_label | default: 'Zurück' }}"
             title="{{ section.settings.back_label | default: 'Zurück' }}">
            <svg class="custom-header__back-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            {% if section.settings.back_label != blank %}
              <span class="custom-header__back-label">{{ section.settings.back_label }}</span>
            {% endif %}
          </a>
        {% endif %}
      {% endif %}
    </div>

    <div class="custom-header__right-side">

      <div class="custom-header__nav-wrapper">
        <nav class="custom-header__nav" role="navigation">
          {%- for link in section.settings.menu.links -%}
            <a href="{{ link.url }}" class="custom-header__nav-link {% if link.active %}active{% endif %}">{{ link.title }}</a>
          {%- endfor -%}
        </nav>

        {%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
          <a href="{{ section.settings.button_link }}" class="custom-header__contact-btn">{{ section.settings.button_text }}</a>
        {%- endif -%}
      </div>

      {% if section.settings.button_text != blank and section.settings.button_link != blank %}
        <a href="{{ section.settings.button_link }}" class="custom-header__contact-btn custom-header__cta-mobile">
          {{ section.settings.button_text }}
        </a>
      {% endif %}

      <button class="custom-header__mobile-toggle"
              aria-label="Menü öffnen"
              aria-controls="mobile-drawer-{{ section.id }}"
              aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div class="custom-header__overlay" data-drawer-overlay hidden></div>

    <aside id="mobile-drawer-{{ section.id }}"
           class="custom-header__drawer"
           aria-hidden="true"
           tabindex="-1">
      <div class="custom-header__drawer-header">
        <p class="custom-header__drawer-title">{{ section.settings.logo_text | default: shop.name }}</p>
        <button class="custom-header__drawer-close" aria-label="Menü schließen">
          <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <nav class="custom-header__drawer-nav" role="navigation" aria-label="Mobile Navigation">
        {%- for link in section.settings.menu.links -%}
          <a href="{{ link.url }}" class="custom-header__drawer-link {% if link.active %}active{% endif %}">
            {{ link.title }}
          </a>
        {%- endfor -%}
      </nav>

      {%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
        <div class="custom-header__drawer-cta">
          <a href="{{ section.settings.button_link }}" class="custom-header__contact-btn" style="width:100%; text-align:center;">
            {{ section.settings.button_text }}
          </a>
        </div>
      {%- endif -%}
    </aside>

  </div>
</header>

<script>
  (function(){
    var header = document.getElementById('sticky-header-{{ section.id }}');
    if(!header) return;
    function setOffsets(){
      var h = header.offsetHeight;
      var bar = document.querySelector('[data-announcement-bar], .announcement-bar, .shopify-section-announcement');
      if (bar) {
        var barH = bar.offsetHeight || 0;
        header.style.top = barH + 'px';
        h = header.offsetHeight + barH;
      } else {
        header.style.top = '0px';
      }
      document.body.style.paddingTop = h + 'px';
    }
    setOffsets();
    window.addEventListener('resize', setOffsets);
    if('ResizeObserver' in window) new ResizeObserver(setOffsets).observe(header);
  })();
</script>

<script>
  (function(){
    var header = document.getElementById('sticky-header-{{ section.id }}');
    if(!header) return;

    var toggle  = header.querySelector('.custom-header__mobile-toggle');
    var drawer  = document.getElementById('mobile-drawer-{{ section.id }}');
    var overlay = header.querySelector('[data-drawer-overlay]');
    var closeBtn = header.querySelector('.custom-header__drawer-close');

    function openDrawer(){
      if(!drawer) return;
      header.classList.add('is-drawer-open');
      drawer.setAttribute('aria-hidden', 'false');
      toggle && toggle.setAttribute('aria-expanded','true');
      overlay && (overlay.hidden = false);
      document.documentElement.classList.add('no-scroll');
      setTimeout(function(){ drawer.focus(); }, 10);
    }

    function closeDrawer(){
      if(!drawer) return;
      header.classList.remove('is-drawer-open');
      drawer.setAttribute('aria-hidden', 'true');
      toggle && toggle.setAttribute('aria-expanded','false');
      document.documentElement.classList.remove('no-scroll');
      setTimeout(function(){ overlay && (overlay.hidden = true); }, 300);
    }

    toggle && toggle.addEventListener('click', function(e){
      e.preventDefault();
      if (header.classList.contains('is-drawer-open')) { closeDrawer(); } else { openDrawer(); }
    });

    overlay && overlay.addEventListener('click', closeDrawer);
    closeBtn && closeBtn.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeDrawer(); });
  })();
</script>