{% comment %}
  Custom Header Section – Dawn-kompatibel
  - Logo: Text oder Bild
  - Menü-Auswahl, fett/normal
  - Hover-/Aktiv-Farbe
  - X/Y-Offsets in %
  - Account-/Cart-Icons mit Dawn-Hooks & deinen SVGs
{% endcomment %}

{{ 'custom-header.css' | asset_url | stylesheet_tag }}

{%- comment -%} Dawn-Komponenten laden (wie im Original-Header) {%- endcomment -%}
<link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-menu-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-cart-notification.css' | asset_url }}" media="print" onload="this.media='all'">
<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>

<header
  class="ch-header"
  style="
    --ch-hover: {{ section.settings.hover_color }};
    --ch-active: {{ section.settings.active_color }};
    --ch-logo-x: {{ section.settings.logo_offset_x | default: 0 }}%;
    --ch-logo-y: {{ section.settings.logo_offset_y | default: 0 }}%;
    --ch-menu-x: {{ section.settings.menu_offset_x | default: 0 }}%;
    --ch-menu-y: {{ section.settings.menu_offset_y | default: 0 }}%;
    --ch-menu-weight: {% if section.settings.menu_bold %}700{% else %}400{% endif %};
  "
  role="banner"
>
  <div class="ch-inner">
    {%- comment -%} Logo {%- endcomment -%}
    <div class="ch-logo-wrap" style="transform: translate(var(--ch-logo-x), var(--ch-logo-y));">
      {% if section.settings.logo_type == 'text' %}
        {% assign logo_text = section.settings.logo_text | default: shop.name %}
        <a class="ch-logo ch-logo--text" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
          {{ logo_text }}
        </a>
      {% else %}
        {% if section.settings.logo_image != blank %}
          <a class="ch-logo ch-logo--image" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
            <img
              src="{{ section.settings.logo_image | image_url: width: 300 }}"
              srcset="{{ section.settings.logo_image | image_url: width: 150 }} 150w, {{ section.settings.logo_image | image_url: width: 300 }} 300w, {{ section.settings.logo_image | image_url: width: 600 }} 600w"
              sizes="(max-width: 600px) 150px, 200px"
              width="{{ section.settings.logo_image.width }}"
              height="{{ section.settings.logo_image.height }}"
              alt="{{ section.settings.logo_alt | escape }}"
              loading="eager"
            >
          </a>
        {% else %}
          <a class="ch-logo ch-logo--text" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">{{ shop.name }}</a>
        {% endif %}
      {% endif %}
    </div>

    {%- comment -%} Navigation {%- endcomment -%}
    <nav class="ch-nav" style="transform: translate(var(--ch-menu-x), var(--ch-menu-y));" aria-label="Hauptmenü">
      {% if section.settings.main_menu != blank %}
        <ul class="ch-menu" role="list">
          {% for link in linklists[section.settings.main_menu].links %}
            {% assign is_active = link.active %}
            <li class="ch-menu__item">
              <a href="{{ link.url }}" class="ch-menu__link {% if is_active %}is-active{% endif %}" aria-current="{% if is_active %}page{% endif %}">
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="ch-menu--placeholder"><em>Bitte ein Menü in den Section-Einstellungen auswählen.</em></div>
      {% endif %}
    </nav>

    {%- comment -%} Actions / Icons (Dawn-konform) {%- endcomment -%}
    <div class="ch-actions">
      {% if section.settings.show_account_icon and shop.customer_accounts_enabled %}
        <a
          href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
          class="header__icon header__icon--account link focus-inset"
          rel="nofollow"
          aria-label="Benutzerkonto"
        >
          <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
          <span class="visually-hidden">
            {%- if customer -%}{{ 'customer.account_fallback' | t }}{%- else -%}{{ 'customer.log_in' | t }}{%- endif -%}
          </span>
        </a>
      {% endif %}

      {% if section.settings.show_cart_icon %}
        {%- comment -%}
          Exakt wie im Dawn-Header:
          - id="cart-icon-bubble" => JS öffnet Cart-Notification/Drawer
          - Klassen für Fokus & A11y
        {%- endcomment -%}
        <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset" id="cart-icon-bubble" aria-label="{{ 'templates.cart.cart' | t }}">
          {% if cart == empty %}
            <span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>
          {% else %}
            <span class="svg-wrapper">{{ 'icon-cart.svg' | inline_asset_content }}</span>
          {% endif %}
          <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>

          {%- if cart != empty -%}
            <div class="cart-count-bubble">
              {%- if cart.item_count < 100 -%}
                <span aria-hidden="true">{{ cart.item_count }}</span>
              {%- endif -%}
              <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
            </div>
          {%- endif -%}
        </a>
      {% endif %}
    </div>
  </div>
</header>

{%- comment -%}
  Genau wie im Dawn-Header: Wenn Cart-Typ "notification", die Notification-Komponente rendern,
  damit der Klick auf #cart-icon-bubble den Drawer/Overlay nutzt.
{%- endcomment -%}
{%- if settings.cart_type == 'notification' -%}
  {%- render 'cart-notification', color_scheme: settings.color_scheme, desktop_menu_type: 'dropdown' -%}
{%- endif -%}

{% schema %}
{
  "name": "Header",
  "tag": "section",
  "class": "section-custom-header",
  "settings": [
    { "type": "header", "content": "Logo" },
    {
      "type": "radio",
      "id": "logo_type",
      "label": "Logo-Typ",
      "options": [
        { "value": "text", "label": "Schriftzug" },
        { "value": "image", "label": "Bild" }
      ],
      "default": "text"
    },
    { "type": "text", "id": "logo_text", "label": "Schriftzug (bei 'Schriftzug')", "default": "Mein Shop" },
    { "type": "image_picker", "id": "logo_image", "label": "Logobild (bei 'Bild')" },
    { "type": "text", "id": "logo_alt", "label": "Alt-Text für Logobild", "default": "Shop-Logo" },

    { "type": "range", "id": "logo_offset_x", "label": "Logo X-Verschiebung (%)", "min": -50, "max": 50, "step": 1, "unit": "%", "default": 0 },
    { "type": "range", "id": "logo_offset_y", "label": "Logo Y-Verschiebung (%)", "min": -50, "max": 50, "step": 1, "unit": "%", "default": 0 },

    { "type": "header", "content": "Navigation" },
    { "type": "link_list", "id": "main_menu", "label": "Menü auswählen" },
    { "type": "checkbox", "id": "menu_bold", "label": "Menü fett darstellen", "default": false },

    { "type": "range", "id": "menu_offset_x", "label": "Menü X-Verschiebung (%)", "min": -50, "max": 50, "step": 1, "unit": "%", "default": 0 },
    { "type": "range", "id": "menu_offset_y", "label": "Menü Y-Verschiebung (%)", "min": -50, "max": 50, "step": 1, "unit": "%", "default": 0 },

    { "type": "color", "id": "hover_color", "label": "Farbe beim Hover über Menüpunkt", "default": "#1a1a1a" },
    { "type": "color", "id": "active_color", "label": "Farbe für aktiven Menüpunkt", "default": "#000000" },

    { "type": "header", "content": "Icons" },
    { "type": "checkbox", "id": "show_cart_icon", "label": "Warenkorb-Icon anzeigen", "default": true },
    { "type": "checkbox", "id": "show_account_icon", "label": "Benutzerkonto-Icon anzeigen", "default": false }
  ],
  "blocks": [],
  "presets": [{ "name": "Header", "category": "Header" }]
}
{% endschema %}
